# Vercel ä¸€é”®éƒ¨ç½² - å­åŸŸååŠŸèƒ½å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

æˆ‘å·²ç»ä¸ºä½ çš„é¡¹ç›®å®ç°äº†å®Œæ•´çš„ Vercel ä¸€é”®éƒ¨ç½²å­åŸŸååŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯æ‰€æœ‰çš„æ”¹åŠ¨ï¼š

### ğŸ“ æ–°å¢æ–‡ä»¶

1. **æ–‡æ¡£**
   - `/VERCEL_SUBDOMAIN_SOLUTION.md` - å®Œæ•´çš„æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£
   - `/SUBDOMAIN_DEPLOYMENT_GUIDE.md` - éƒ¨ç½²æŒ‡å—
   - æœ¬æ–‡ä»¶ `/IMPLEMENTATION_SUMMARY.md`

2. **æ•°æ®åº“è¿ç§»**
   - `/migrations/add_subdomain_support.sql` - æ•°æ®åº“æ¶æ„æ›´æ–°
     * æ·»åŠ  `subdomain`, `custom_domain`, `deployed_at`, `deployment_status` å­—æ®µ
     * åˆ›å»º `reserved_subdomains` è¡¨
     * åˆ›å»º `deployment_history` è¡¨
     * æ·»åŠ çº¦æŸå’Œè§¦å‘å™¨

3. **å·¥å…·å‡½æ•°**
   - `/src/lib/subdomain.ts` - å­åŸŸåéªŒè¯å’Œå¤„ç†å‡½æ•°
     * `validateSubdomain()` - éªŒè¯å­åŸŸåæ ¼å¼
     * `checkSubdomainAvailability()` - æ£€æŸ¥å¯ç”¨æ€§
     * `suggestSubdomain()` - è‡ªåŠ¨å»ºè®®å­åŸŸå
     * `getSubdomainUrl()` - ç”Ÿæˆå®Œæ•´ URL
     * `extractSubdomain()` - ä»ä¸»æœºåæå–å­åŸŸå
     * `getVercelDeployUrl()` - ç”Ÿæˆ Vercel éƒ¨ç½²é“¾æ¥

4. **API è·¯ç”±**
   - `/src/app/api/subdomain/check/route.ts` - å­åŸŸåå¯ç”¨æ€§æ£€æŸ¥ API

5. **è„šæœ¬**
   - `/scripts/migrate-subdomain.js` - è‡ªåŠ¨åŒ–è¿ç§»è„šæœ¬

### ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

1. **`/src/components/studio/PublishModal.tsx`**
   - å®Œå…¨é‡å†™ï¼Œæ·»åŠ äº†ï¼š
     * å®æ—¶å­åŸŸåéªŒè¯
     * å¯ç”¨æ€§æ£€æŸ¥
     * è‡ªåŠ¨å»ºè®®åŠŸèƒ½
     * å¤šæ­¥éª¤å‘å¸ƒæµç¨‹
     * Vercel éƒ¨ç½²é›†æˆ
     * æ›´å¥½çš„ UI/UX

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### æ­¥éª¤ 1ï¼šåº”ç”¨æ•°æ®åº“è¿ç§»

**æ–¹æ³• Aï¼šä½¿ç”¨ Supabase Dashboardï¼ˆæ¨èï¼‰**

1. è®¿é—® [Supabase Dashboard](https://app.supabase.com)
2. è¿›å…¥ä½ çš„é¡¹ç›®
3. æ‰“å¼€ SQL Editor
4. å¤åˆ¶ `/migrations/add_subdomain_support.sql` çš„å†…å®¹
5. ç‚¹å‡» Run

**æ–¹æ³• Bï¼šä½¿ç”¨è‡ªåŠ¨è„šæœ¬**

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export SUPABASE_SERVICE_ROLE_KEY="your_service_role_key"

# è¿è¡Œè¿ç§»
node scripts/migrate-subdomain.js
```

### æ­¥éª¤ 2ï¼šæµ‹è¯•åŠŸèƒ½

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®ç¼–è¾‘å™¨
open http://localhost:3006/studio/new
```

æµ‹è¯•æµç¨‹ï¼š
1. åœ¨ç¼–è¾‘å™¨ä¸­ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®
2. è¾“å…¥å­åŸŸåï¼ˆä¾‹å¦‚ï¼š`my-test-site`ï¼‰
3. è§‚å¯Ÿå®æ—¶éªŒè¯å’Œå¯ç”¨æ€§æ£€æŸ¥
4. å°è¯•ä½¿ç”¨ä¿ç•™å­—ï¼ˆå¦‚ `www`ã€`api`ï¼‰- åº”è¯¥è¢«æ‹’ç»
5. ç‚¹å‡»"å‘å¸ƒåˆ° dao123 å­åŸŸå"æµ‹è¯•å¿«é€Ÿå‘å¸ƒ
6. ç‚¹å‡»"éƒ¨ç½²åˆ° Vercel"æµ‹è¯• Vercel é›†æˆ

### æ­¥éª¤ 3ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆå¯é€‰ï¼‰

**å¦‚æœè¦å¯ç”¨çœŸå®çš„å­åŸŸåè®¿é—®ï¼Œéœ€è¦é…ç½® DNSï¼š**

#### é€‰é¡¹ Aï¼šVercel æ³›åŸŸåï¼ˆæ¨èï¼‰

**è¦æ±‚**ï¼š
- Vercel Pro è®¡åˆ’ï¼ˆ$20/æœˆï¼‰
- èƒ½å¤Ÿä¿®æ”¹åŸŸåçš„ Nameservers

**æ­¥éª¤**ï¼š
1. å°†åŸŸå Nameservers æ”¹ä¸ºï¼š
   ```
   ns1.vercel-dns.com
   ns2.vercel-dns.com
   ```

2. åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ï¼š
   - `dao123.me`
   - `*.dao123.me`

3. Vercel ä¼šè‡ªåŠ¨å¤„ç† SSL è¯ä¹¦

#### é€‰é¡¹ Bï¼šä»…ä½¿ç”¨ Vercel é»˜è®¤åŸŸåï¼ˆå…è´¹ï¼‰

ç”¨æˆ·éƒ¨ç½²åä¼šè·å¾— `*.vercel.app` åŸŸåï¼Œå®Œå…¨å…è´¹ã€‚

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### âœ… å‰ç«¯åŠŸèƒ½

1. **æ™ºèƒ½è¾“å…¥éªŒè¯**
   - å®æ—¶æ ¼å¼æ£€æŸ¥
   - é•¿åº¦éªŒè¯ï¼ˆ3-63 å­—ç¬¦ï¼‰
   - ä¿ç•™å­—æ‹¦æˆª
   - è‡ªåŠ¨è½¬å°å†™

2. **å¯ç”¨æ€§æ£€æŸ¥**
   - é˜²æŠ–è¾“å…¥ï¼ˆ500mså»¶è¿Ÿï¼‰
   - åç«¯æ•°æ®åº“æŸ¥è¯¢
   - è§†è§‰åé¦ˆï¼ˆâœ“ å¯ç”¨ / âœ— ä¸å¯ç”¨ï¼‰

3. **è‡ªåŠ¨å»ºè®®**
   - åŸºäºé¡¹ç›®åç§°ç”Ÿæˆå­åŸŸå
   - è‡ªåŠ¨æ¸…ç†ç‰¹æ®Šå­—ç¬¦
   - æ™ºèƒ½æ›¿æ¢ç©ºæ ¼ä¸ºè¿å­—ç¬¦

4. **å¤šæ­¥éª¤å‘å¸ƒ**
   - é€‰æ‹©å‘å¸ƒæ–¹å¼
   - ç¡®è®¤é…ç½®
   - éƒ¨ç½²æŒ‡å¯¼
   - æˆåŠŸç¡®è®¤

### âœ… åç«¯åŠŸèƒ½

1. **æ•°æ®åº“æ¶æ„**
   - å­åŸŸåå”¯ä¸€æ€§çº¦æŸ
   - æ ¼å¼éªŒè¯çº¦æŸ
   - éƒ¨ç½²çŠ¶æ€è¿½è¸ª
   - éƒ¨ç½²å†å²è®°å½•

2. **å®‰å…¨æªæ–½**
   - ä¿ç•™å­—ç³»ç»Ÿ
   - æ ¼å¼æ£€æŸ¥è§¦å‘å™¨
   - RLS ç­–ç•¥
   - SQL æ³¨å…¥é˜²æŠ¤

3. **API ç«¯ç‚¹**
   - `/api/subdomain/check` - æ£€æŸ¥å¯ç”¨æ€§
   - æ ‡å‡†åŒ–å¤„ç†
   - é”™è¯¯å¤„ç†

---

## ğŸ“Š æ•°æ®åº“æ¶æ„

### Projects è¡¨æ›´æ–°

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `subdomain` | TEXT | ç”¨æˆ·è‡ªå®šä¹‰å­åŸŸåï¼ˆå”¯ä¸€ï¼‰ |
| `custom_domain` | TEXT | è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰ |
| `deployed_at` | TIMESTAMPTZ | æœ€åéƒ¨ç½²æ—¶é—´ |
| `deployment_status` | TEXT | éƒ¨ç½²çŠ¶æ€ï¼ˆdraft/deploying/deployed/failedï¼‰ |

### æ–°è¡¨

#### reserved_subdomains
ä¿ç•™çš„ç³»ç»Ÿå­åŸŸåï¼Œé˜²æ­¢ç”¨æˆ·å ç”¨å…³é”®åç§°ã€‚

#### deployment_history
éƒ¨ç½²å†å²è®°å½•ï¼Œç”¨äºå®¡è®¡å’Œç»Ÿè®¡ã€‚

---

## ğŸ” éªŒè¯æ£€æŸ¥

### å­åŸŸåè§„åˆ™

âœ… **å…è®¸**:
- `my-site`
- `alex-portfolio`
- `blog2024`
- `cool-app-123`

âŒ **ä¸å…è®¸**:
- `ab` (å¤ªçŸ­)
- `www` (ä¿ç•™å­—)
- `api` (ä¿ç•™å­—)
- `-mysite` (ä»¥è¿å­—ç¬¦å¼€å¤´)
- `mysite-` (ä»¥è¿å­—ç¬¦ç»“å°¾)
- `my--site` (è¿ç»­è¿å­—ç¬¦)
- `My-Site` (å¤§å†™)
- `my_site` (ä¸‹åˆ’çº¿)
- `my.site` (ç‚¹å·)

### ä¿ç•™å­—åˆ—è¡¨

ç³»ç»Ÿä¿ç•™äº† 32 ä¸ªå¸¸ç”¨å­åŸŸåï¼š
- `www`, `api`, `admin`, `app`
- `mail`, `ftp`, `smtp`, `pop`, `imap`
- `blog`, `shop`, `store`
- `dev`, `staging`, `test`
- `static`, `assets`, `cdn`
- `docs`, `help`, `support`, `status`
- `dashboard`, `console`, `portal`
- `vpn`, `ssh`, `git`, `svn`
- `mysql`, `postgres`, `redis`, `memcached`

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯ä»£ç 

```typescript
import { validateSubdomain, checkSubdomainAvailability } from '@/lib/subdomain';

// éªŒè¯æ ¼å¼
const validation = validateSubdomain('my-site');
if (!validation.valid) {
  console.log(validation.error);
}

// æ£€æŸ¥å¯ç”¨æ€§
const availability = await checkSubdomainAvailability('my-site');
if (availability.available) {
  console.log('å¯ç”¨ï¼');
}
```

### API è°ƒç”¨

```bash
# æ£€æŸ¥å­åŸŸåå¯ç”¨æ€§
POST /api/subdomain/check
Content-Type: application/json

{
  "subdomain": "my-test-site"
}

# å“åº”
{
  "available": true
}
```

---

## ğŸ”® æœªæ¥æ‰©å±•

å½“å‰å®ç°æ˜¯ MVP ç‰ˆæœ¬ï¼Œæœªæ¥å¯ä»¥æ·»åŠ ï¼š

1. **å®Œæ•´çš„ Vercel API é›†æˆ**
   - è‡ªåŠ¨åˆ›å»ºéƒ¨ç½²
   - è‡ªåŠ¨æ·»åŠ è‡ªå®šä¹‰åŸŸå
   - éƒ¨ç½²çŠ¶æ€å®æ—¶åŒæ­¥

2. **Viewer æ¨¡æ¿ä»“åº“**
   - ç‹¬ç«‹çš„å±•ç¤ºåº”ç”¨
   - åŠ¨æ€åŠ è½½ç”¨æˆ·å†…å®¹
   - å­åŸŸåè·¯ç”±

3. **è‡ªå®šä¹‰åŸŸå**
   - è®©ç”¨æˆ·ç»‘å®šè‡ªå·±çš„åŸŸå
   - DNS éªŒè¯æµç¨‹
   - SSL è¯ä¹¦ç®¡ç†

4. **é«˜çº§åˆ†æ**
   - è®¿é—®ç»Ÿè®¡
   - æ€§èƒ½ç›‘æ§
   - éƒ¨ç½²æˆåŠŸç‡

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æŠ€æœ¯æ–¹æ¡ˆ**: `/VERCEL_SUBDOMAIN_SOLUTION.md`
  * æ·±å…¥çš„æŠ€æœ¯ç»†èŠ‚
  * å¤šç§å®ç°æ–¹æ¡ˆå¯¹æ¯”
  * æ¶æ„è®¾è®¡

- **éƒ¨ç½²æŒ‡å—**: `/SUBDOMAIN_DEPLOYMENT_GUIDE.md`
  * é€æ­¥éƒ¨ç½²è¯´æ˜
  * DNS é…ç½®æŒ‡å—
  * æ•…éšœæ’é™¤

- **æ•°æ®åº“è¿ç§»**: `/migrations/add_subdomain_support.sql`
  * å®Œæ•´çš„ SQL è„šæœ¬
  * åŒ…å«æ³¨é‡Šè¯´æ˜

---

## âš™ï¸ ç¯å¢ƒå˜é‡

éœ€è¦åœ¨ `.env.local` ä¸­æ·»åŠ ï¼ˆå¯é€‰ï¼‰ï¼š

```bash
# åŸºç¡€åŸŸå
NEXT_PUBLIC_BASE_DOMAIN=dao123.me

# Vercel æ¨¡æ¿ä»“åº“ï¼ˆç”¨äºä¸€é”®éƒ¨ç½²ï¼‰
NEXT_PUBLIC_VIEWER_TEMPLATE_REPO=your-username/dao123-viewer-template

# Vercel API Tokenï¼ˆç”¨äºè‡ªåŠ¨åŒ–ï¼‰
VERCEL_TOKEN=your_token
```

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„åº”ç”¨å·²ç»å…·å¤‡äº†å®Œæ•´çš„å­åŸŸååŠŸèƒ½ï¼š

1. âœ… ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å­åŸŸå
2. âœ… å®æ—¶éªŒè¯å’Œå¯ç”¨æ€§æ£€æŸ¥
3. âœ… æ•°æ®åº“æŒä¹…åŒ–
4. âœ… Vercel éƒ¨ç½²é›†æˆ
5. âœ… å®‰å…¨çš„ä¿ç•™å­—ç³»ç»Ÿ
6. âœ… å®Œæ•´çš„éƒ¨ç½²å†å²

**ä¸‹ä¸€æ­¥å»ºè®®**ï¼š
1. åº”ç”¨æ•°æ®åº“è¿ç§»
2. æµ‹è¯•æœ¬åœ°åŠŸèƒ½
3. ï¼ˆå¯é€‰ï¼‰é…ç½®ç”Ÿäº§ç¯å¢ƒ DNS
4. ï¼ˆå¯é€‰ï¼‰åˆ›å»º Viewer æ¨¡æ¿ä»“åº“

æœ‰ä»»ä½•é—®é¢˜è¯·æŸ¥çœ‹æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒï¼ğŸš€
